<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="icon" type="image/png" href="../Logos/Pougotchi.png" />
    <title>POUGOTCHI - Trollas. Inc.</title>
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700&display=swap"
      rel="stylesheet" />
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
        font-family: "Inter", sans-serif;
      }
      a.disabled {
        pointer-events: none; /* desactiva clicks */
        color: gray; /* indica visualmente que est√° desactivado */
        text-decoration: none;
        opacity: 0.6;
        cursor: default;
      }

      body {
        background: #f0f4f8;
        color: #111;
      }
      header {
        backdrop-filter: blur(10px);
        background: rgba(255, 255, 255, 0.5);
        padding: 1rem 2rem;
        display: flex;
        justify-content: space-between;
        align-items: center;
        position: sticky;
        top: 0;
        z-index: 100;
      }
      header h1 {
        font-weight: 700;
      }
      nav a {
        margin-left: 1.5rem;
        text-decoration: none;
        color: #111;
        font-weight: 500;
      }
      main {
        padding: 4rem 2rem;
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 2rem;
      }
      .game-container {
        background: rgba(255, 255, 255, 0.5);
        backdrop-filter: blur(10px);
        border-radius: 15px;
        padding: 2rem;
        max-width: 600px;
        width: 100%;
        text-align: center;
      }
      .game-container img {
        width: 100%;
        border-radius: 10px;
        margin-bottom: 1rem;
      }
      .btn {
        display: inline-block;
        margin-top: 1rem;
        padding: 0.5rem 1.5rem;
        background: rgba(0, 0, 0, 0.1);
        backdrop-filter: blur(5px);
        border-radius: 10px;
        text-decoration: none;
        color: #111;
        font-weight: 500;
        transition: background 0.3s;
      }
      .btn:hover {
        background: rgba(0, 0, 0, 0.2);
      }
      footer {
        text-align: center;
        padding: 2rem;
        font-size: 0.9rem;
        color: #555;
      }
    </style>
  </head>
  <body>
    <header>
      <h1>Trollas. Inc.</h1>
      <nav>
        <a href="../index.html">‚¨ÖÔ∏è Volver ‚¨ÖÔ∏è</a>
      </nav>
    </header>

    <main>
      <div class="game-container">
        <img src="../Logos/Pougotchi.png" alt="Balancea! Balancea!" />
        <h2>POUGOTCHI</h2>
        <p>Una mezcla entre un POU y un TAMAGOTCHI, Simple pero con IA üòé</p>
        <p style="color: red">*A√∫n no disponible</p>
        <a href="#" class="btn disabled">Descargar</a>
      </div>
    </main>
    <footer>&copy; 2025 Trollas. Inc. Todos los derechos reservados.</footer>
    <script type="module">
      import { initializeApp } from "https://www.gstatic.com/firebasejs/12.4.0/firebase-app.js";
      import {
        getFirestore,
        doc,
        getDoc,
        setDoc,
        updateDoc,
        increment,
        collection,
        addDoc,
      } from "https://www.gstatic.com/firebasejs/12.4.0/firebase-firestore.js";

      // Config Firebase
      const firebaseConfig = {
        apiKey: "AIzaSyCx8ITT_KZVSzZTWN20qV1yEZ5CwILkm2M",
        authDomain: "trollas-inc-administracion.firebaseapp.com",
        projectId: "trollas-inc-administracion",
        storageBucket: "trollas-inc-administracion.firebasestorage.app",
        messagingSenderId: "247309275509",
        appId: "1:247309275509:web:33d62925b18474b2ac833c",
        measurementId: "G-G2T4HD22YH",
      };
      const app = initializeApp(firebaseConfig);
      const db = getFirestore(app);

      // Contar visita solo una vez por dispositivo
      async function contarVisitaUnaVez() {
        const yaVisito = localStorage.getItem("yaVisito");
        if (yaVisito) return;

        const visitasRef = doc(db, "estadisticas", "visitas");
        const visitasSnap = await getDoc(visitasRef);

        if (!visitasSnap.exists()) {
          await setDoc(visitasRef, { contador: 1 });
        } else {
          await updateDoc(visitasRef, { contador: increment(1) });
        }

        localStorage.setItem("yaVisito", "true");
      }

      // Info del dispositivo
      function obtenerInfoDispositivo() {
        const ua = navigator.userAgent || "";
        let so = "Desconocido";
        if (/Android/i.test(ua)) so = "Android";
        else if (/iPhone|iPad|iPod/i.test(ua)) so = "iOS";
        else if (/Windows/i.test(ua)) so = "Windows";
        else if (/Mac/i.test(ua)) so = "MacOS";
        else if (/Linux/i.test(ua)) so = "Linux";

        const dispositivo = /Android|iPhone|iPad|iPod/i.test(ua)
          ? "M√≥vil"
          : "PC";

        let navegador = "Desconocido";
        if (/Chrome/i.test(ua) && !/Edge|OPR/i.test(ua)) navegador = "Chrome";
        else if (/Firefox/i.test(ua)) navegador = "Firefox";
        else if (/Safari/i.test(ua) && !/Chrome/i.test(ua))
          navegador = "Safari";
        else if (/Edge/i.test(ua)) navegador = "Edge";
        else if (/OPR|Opera/i.test(ua)) navegador = "Opera";

        const resolucion = `${window.innerWidth}x${window.innerHeight}`;
        const idioma = navigator.language || navigator.userLanguage || "";

        return {
          visitanteID: obtenerVisitanteID(),
          timestamp: new Date().toISOString(),
          so,
          dispositivo,
          navegador,
          resolucion,
          idioma,
          referrer: document.referrer || "",
          page: location.pathname + location.search || "",
        };
      }

      // Generar ID √∫nico por visitante
      function obtenerVisitanteID() {
        let id = localStorage.getItem("visitanteID");
        if (!id) {
          id =
            crypto && crypto.randomUUID
              ? crypto.randomUUID()
              : "v-" +
                Date.now() +
                "-" +
                Math.random().toString(36).slice(2, 9);
          localStorage.setItem("visitanteID", id);
        }
        return id;
      }

      // Obtener IP
      async function obtenerIP() {
        try {
          const res = await fetch("https://ipapi.co/json/");
          const data = await res.json();
          return {
            ip: data.ip || "",
            ciudad: data.city || "",
            pais: data.country_name || "",
          };
        } catch (err) {
          console.error("No se pudo obtener IP:", err);
          return { ip: "", ciudad: "", pais: "" };
        }
      }

      // Registrar visita detallada
      async function registrarVisitaDetalle() {
        try {
          await contarVisitaUnaVez();
          const info = obtenerInfoDispositivo();
          const ipInfo = await obtenerIP();
          const infoCompleta = { ...info, ...ipInfo };
          await addDoc(collection(db, "visitas_detalle"), infoCompleta);
        } catch (err) {
          console.error("Error registrando visita detalle:", err);
        }
      }

      // Ejecutar
      registrarVisitaDetalle();
    </script>
  </body>
</html>
