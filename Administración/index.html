<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Panel de administración - Trollas Inc.</title>
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700&display=swap"
      rel="stylesheet" />
    <style>
      * {
        box-sizing: border-box;
        font-family: "Inter", sans-serif;
      }
      body {
        background: #f4f6f8;
        margin: 0;
        padding: 0;
        color: #111;
      }
      header {
        background: rgba(255, 255, 255, 0.8);
        backdrop-filter: blur(10px);
        padding: 1rem;
        text-align: center;
        font-weight: 700;
        position: sticky;
        top: 0;
        z-index: 100;
      }
      main {
        max-width: 1200px;
        margin: 2rem auto;
        background: white;
        padding: 1.5rem;
        border-radius: 15px;
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
      }
      input,
      button,
      textarea {
        width: 100%;
        padding: 10px;
        margin: 8px 0;
        border-radius: 8px;
        border: 1px solid #ccc;
      }
      button {
        background: #007bff;
        color: white;
        cursor: pointer;
        border: none;
        transition: 0.3s;
      }
      button:hover {
        background: #0056b3;
      }
      .hidden {
        display: none;
      }
      table {
        width: 100%;
        border-collapse: collapse;
        margin-top: 1rem;
        table-layout: fixed;
        word-wrap: break-word;
      }
      th,
      td {
        border: 1px solid #ddd;
        padding: 8px;
        text-align: center;
        vertical-align: middle;
      }
      th {
        background: #f0f0f0;
      }
      .section {
        margin-top: 2rem;
        border-top: 1px solid #ccc;
        padding-top: 1rem;
      }
      .table-container {
        overflow-x: auto;
      }
      .imgPreview {
        width: 40px;
        height: 40px;
        border-radius: 50%;
        object-fit: cover;
      }
      .navbar-admin {
        text-align: center;
        margin: 1rem 0;
        display: flex;
        justify-content: center;
        gap: 2rem;
        flex-wrap: wrap;
      }
      .navbar-admin a {
        color: black;
        text-decoration: none;
        font-weight: 500;
      }
      @media (max-width: 768px) {
        main {
          margin: 1rem;
          padding: 1rem;
        }
        th,
        td {
          font-size: 14px;
          padding: 6px;
        }
        button,
        input,
        textarea {
          font-size: 14px;
          padding: 8px;
        }
      }
      /* pequeño estilo para botones de acción en tablas */
      .small-btn {
        display: inline-block;
        padding: 6px 10px;
        font-size: 13px;
        border-radius: 6px;
        margin: 2px;
      }
      .btn-danger {
        background: crimson;
        color: white;
        border: none;
      }
      .btn-secondary {
        background: #6c757d;
        color: white;
        border: none;
      }
      .muted {
        color: #666;
        font-size: 0.9rem;
      }
    </style>
  </head>
  <body>
    <header>Panel de administración - Trollas. Inc.</header>
    <main>
      <!-- Login -->
      <div id="loginForm">
        <h2>Iniciar sesión</h2>
        <input id="email" type="email" placeholder="Correo" />
        <input id="password" type="password" placeholder="Contraseña" />
        <button id="loginBtn">Entrar</button>
        <p id="loginMsg"></p>
      </div>

      <!-- Panel -->
      <div id="panel" class="hidden">
        <button id="logoutBtn" style="background: crimson">
          Cerrar sesión
        </button>
        <div class="navbar-admin">
          <a href="#visitantes">Visitantes</a>
          <a href="#clientes">Clientes</a>
          <a href="#blog">Blog</a>
          <a href="#detalle-de-visitas">Detalle de visitas</a>
          <a href="#correos">Correos</a>
          <a href="#ip-ban">Gestionar IPs</a>
        </div>

        <!-- Visitantes -->
        <div id="visitantes" class="section">
          <h3>📊 Visitantes</h3>
          <p id="contadorVisitantes">Cargando...</p>
        </div>

        <!-- Clientes -->
        <div id="clientes" class="section">
          <h3>👥 Clientes</h3>
          <h4>Agregar / Editar Cliente</h4>
          <input type="text" id="nombre" placeholder="Nombre" />
          <input type="text" id="apellidos" placeholder="Apellidos" />
          <input type="email" id="correo" placeholder="Correo" />
          <input type="tel" id="telefono" placeholder="Teléfono" />
          <input type="text" id="plan" placeholder="Plan" />
          <textarea
            id="info"
            rows="3"
            placeholder="Información adicional"></textarea>
          <input type="file" id="fotoUpload" accept="image/*" />
          <button id="addClientBtn">Guardar Cliente</button>

          <div class="table-container">
            <table>
              <thead>
                <tr>
                  <th>Foto</th>
                  <th>Nombre</th>
                  <th>Apellidos</th>
                  <th>Correo</th>
                  <th>Teléfono</th>
                  <th>Plan</th>
                  <th>Info</th>
                  <th>Acciones</th>
                </tr>
              </thead>
              <tbody id="tbodyClientes">
                <tr>
                  <td colspan="8" style="text-align: center">
                    Cargando clientes...
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>

        <!-- Blog -->
        <div id="blog" class="section">
          <h3>📰 Subir entrada al blog</h3>
          <input id="blogTitulo" type="text" placeholder="Título" />
          <textarea
            id="blogContenido"
            rows="5"
            placeholder="Contenido (HTML permitido)"></textarea>
          <input id="blogEnlace" type="text" placeholder="Enlace opcional" />
          <button id="addBlogBtn">Publicar entrada</button>
          <p id="blogMsg"></p>
        </div>

        <!-- Detalle de visitas -->
        <div id="detalle-de-visitas" class="section">
          <h3>📈 Detalle de visitas</h3>
          <input type="text" id="buscarIP" placeholder="Buscar por IP..." />
          <button id="btnBuscarIP">Buscar</button>
          <button id="refreshVisitasBtn">🔄 Refrescar</button>

          <div class="table-container">
            <table>
              <thead>
                <tr>
                  <th>Fecha y hora</th>
                  <th>Navegador</th>
                  <th>SO</th>
                  <th>Idioma</th>
                  <th>IP</th>
                  <th>Ciudad</th>
                  <th>Página</th>
                </tr>
              </thead>
              <tbody id="tbodyVisitas">
                <tr>
                  <td colspan="7" style="text-align: center">
                    Cargando visitas...
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>

        <!-- IP Ban Section (nueva) -->
        <div id="ip-ban" class="section">
          <h3>🛑 Gestionar IPs (ban / unban)</h3>

          <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px">
            <div>
              <label class="muted">IP a banear</label>
              <input type="text" id="ipInput" placeholder="Ej: 203.0.113.45" />
              <label class="muted">Motivo</label>
              <input
                type="text"
                id="reasonInput"
                placeholder="Motivo del ban" />
              <label class="muted">Duración (horas, 0 = permanente)</label>
              <input
                type="number"
                id="durationInput"
                placeholder="Horas (ej: 24)" />
              <button id="banBtn" style="margin-top: 6px">Banear IP</button>
            </div>

            <div>
              <label class="muted">Desbanear IP</label>
              <input
                type="text"
                id="unbanIpInput"
                placeholder="IP a desbanear" />
              <button
                id="unbanBtn"
                style="margin-top: 6px; background: #28a745">
                Desbanear IP
              </button>

              <p class="muted" style="margin-top: 12px">Bans actuales:</p>
              <div
                class="table-container"
                style="max-height: 240px; overflow: auto">
                <table>
                  <thead>
                    <tr>
                      <th>IP</th>
                      <th>Perm</th>
                      <th>Expira</th>
                      <th>Operador</th>
                      <th>Acción</th>
                    </tr>
                  </thead>
                  <tbody id="tbodyBans">
                    <tr>
                      <td colspan="5" style="text-align: center">
                        Cargando bans...
                      </td>
                    </tr>
                  </tbody>
                </table>
              </div>
            </div>
          </div>
        </div>

        <!-- Correos -->
        <div id="correos" class="section">
          <h3>📧 Correos registrados</h3>
          <input
            type="text"
            id="buscarCorreo"
            placeholder="Buscar por correo..." />
          <button id="btnBuscarCorreo">Buscar</button>
          <button id="btnRefreshCorreos">🔄 Refrescar</button>

          <div class="table-container">
            <table>
              <thead>
                <tr>
                  <th>Correo</th>
                  <th>Fecha</th>
                </tr>
              </thead>
              <tbody id="tbodyCorreos">
                <tr>
                  <td colspan="2" style="text-align: center">Cargando...</td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </main>

    <script type="module">
      import { initializeApp } from "https://www.gstatic.com/firebasejs/12.4.0/firebase-app.js";
      import {
        getFirestore,
        collection,
        getDocs,
        getDoc,
        addDoc,
        doc,
        updateDoc,
        deleteDoc,
        setDoc,
        query,
        orderBy,
        limit,
      } from "https://www.gstatic.com/firebasejs/12.4.0/firebase-firestore.js";
      import {
        getAuth,
        signInWithEmailAndPassword,
        signOut,
        onAuthStateChanged,
      } from "https://www.gstatic.com/firebasejs/12.4.0/firebase-auth.js";

      // --- Configuración Firebase ---
      const firebaseConfig = {
        apiKey: "AIzaSyCx8ITT_KZVSzZTWN20qV1yEZ5CwILkm2M",
        authDomain: "trollas-inc-administracion.firebaseapp.com",
        projectId: "trollas-inc-administracion",
        storageBucket: "trollas-inc-administracion.firebasestorage.app",
        messagingSenderId: "247309275509",
        appId: "1:247309275509:web:33d62925b18474b2ac833c",
        measurementId: "G-G2T4HD22YH",
      };
      const app = initializeApp(firebaseConfig);
      const db = getFirestore(app);
      const auth = getAuth(app);

      // --- Elementos ---
      const loginForm = document.getElementById("loginForm");
      const loginBtn = document.getElementById("loginBtn");
      const logoutBtn = document.getElementById("logoutBtn");
      const panel = document.getElementById("panel");
      const loginMsg = document.getElementById("loginMsg");

      // Clientes
      const nombre = document.getElementById("nombre");
      const apellidos = document.getElementById("apellidos");
      const correo = document.getElementById("correo");
      const telefono = document.getElementById("telefono");
      const plan = document.getElementById("plan");
      const info = document.getElementById("info");
      const fotoUpload = document.getElementById("fotoUpload");
      const addClientBtn = document.getElementById("addClientBtn");
      const tbodyClientes = document.getElementById("tbodyClientes");
      const contadorVisitantes = document.getElementById("contadorVisitantes");

      // Visitas y correos
      const tbodyVisitas = document.getElementById("tbodyVisitas");
      const tbodyBans = document.getElementById("tbodyBans");
      const tbodyCorreos = document.getElementById("tbodyCorreos");

      // IP ban elements
      const ipInput = document.getElementById("ipInput");
      const reasonInput = document.getElementById("reasonInput");
      const durationInput = document.getElementById("durationInput");
      const banBtn = document.getElementById("banBtn");
      const unbanIpInput = document.getElementById("unbanIpInput");
      const unbanBtn = document.getElementById("unbanBtn");

      let clientes = [];
      let editando = false;
      let clienteEditandoId = null;
      let imagenCliente = null;

      // --- Login ---
      loginBtn.addEventListener("click", async () => {
        try {
          await signInWithEmailAndPassword(
            auth,
            document.getElementById("email").value,
            document.getElementById("password").value
          );
        } catch (err) {
          loginMsg.textContent = err.message;
        }
      });

      logoutBtn.addEventListener("click", () => signOut(auth));

      onAuthStateChanged(auth, async (user) => {
        if (user) {
          loginForm.style.display = "none";
          panel.classList.remove("hidden");
          await cargarClientes();
          await cargarVisitantes();
          await cargarVisitasDetalle();
          await cargarCorreos();
          await cargarBans(); // cargamos bans en la UI
        } else {
          loginForm.style.display = "block";
          panel.classList.add("hidden");
        }
      });

      // --- Clientes ---
      async function cargarClientes() {
        try {
          const snap = await getDocs(collection(db, "clientes"));
          clientes = snap.docs.map((docSnap) => ({
            id: docSnap.id,
            ...docSnap.data(),
          }));
          mostrarClientes();
        } catch (err) {
          console.error(err);
          tbodyClientes.innerHTML =
            "<tr><td colspan='8' style='text-align:center;color:red'>Error cargando clientes</td></tr>";
        }
      }

      function mostrarClientes() {
        if (clientes.length === 0) {
          tbodyClientes.innerHTML =
            "<tr><td colspan='8' style='text-align:center'>No hay clientes</td></tr>";
          return;
        }
        tbodyClientes.innerHTML = "";
        clientes.forEach((c) => {
          tbodyClientes.innerHTML += `<tr>
      <td>${c.foto ? `<img src="${c.foto}" class="imgPreview">` : "-"}</td>
      <td>${c.nombre || ""}</td>
      <td>${c.apellidos || ""}</td>
      <td>${c.correo || ""}</td>
      <td>${c.telefono || ""}</td>
      <td>${c.plan || ""}</td>
      <td>${c.info || ""}</td>
      <td>
        <button onclick="editarCliente('${
          c.id
        }')" class="small-btn btn-secondary">Editar</button>
        <button onclick="eliminarCliente('${
          c.id
        }')" class="small-btn btn-danger">Eliminar</button>
      </td>
    </tr>`;
        });
      }

      window.editarCliente = function (id) {
        const c = clientes.find((cl) => cl.id === id);
        if (!c) return;
        nombre.value = c.nombre;
        apellidos.value = c.apellidos;
        correo.value = c.correo;
        telefono.value = c.telefono;
        plan.value = c.plan;
        info.value = c.info;
        imagenCliente = c.foto;
        editando = true;
        clienteEditandoId = id;
        addClientBtn.textContent = "Actualizar Cliente";
        window.scrollTo({ top: 0, behavior: "smooth" });
      };

      window.eliminarCliente = async function (id) {
        if (confirm("Eliminar este cliente?")) {
          await deleteDoc(doc(db, "clientes", id));
          cargarClientes();
        }
      };

      addClientBtn.addEventListener("click", async () => {
        if (!nombre.value || !apellidos.value || !correo.value)
          return alert("Nombre, Apellidos y Correo obligatorios");
        const cliente = {
          nombre: nombre.value,
          apellidos: apellidos.value,
          correo: correo.value,
          telefono: telefono.value,
          plan: plan.value,
          info: info.value,
          foto: imagenCliente || "",
        };
        if (editando) {
          const docRef = doc(db, "clientes", clienteEditandoId);
          await updateDoc(docRef, cliente);
          editando = false;
          clienteEditandoId = null;
          addClientBtn.textContent = "Guardar Cliente";
        } else {
          await addDoc(collection(db, "clientes"), cliente);
        }
        limpiarFormulario();
        cargarClientes();
      });

      function limpiarFormulario() {
        nombre.value = "";
        apellidos.value = "";
        correo.value = "";
        telefono.value = "";
        plan.value = "";
        info.value = "";
        fotoUpload.value = "";
        imagenCliente = null;
      }

      fotoUpload.addEventListener("change", (e) => {
        const file = e.target.files[0];
        if (file) {
          const reader = new FileReader();
          reader.onload = (ev) => (imagenCliente = ev.target.result);
          reader.readAsDataURL(file);
        }
      });

      // --- Visitantes ---
      async function cargarVisitantes() {
        try {
          const visitasSnap = await getDoc(doc(db, "estadisticas", "visitas"));
          const contador = visitasSnap.exists()
            ? visitasSnap.data().contador
            : 0;
          contadorVisitantes.textContent = "Total visitantes: " + contador;
        } catch (err) {
          contadorVisitantes.textContent = "Error cargando visitantes";
          console.error(err);
        }
      }

      // --- Detalle visitas ---
      async function cargarVisitasDetalle(filtroIP = "") {
        tbodyVisitas.innerHTML =
          "<tr><td colspan='7' style='text-align:center'>Cargando...</td></tr>";

        try {
          const q = query(
            collection(db, "visitas_detalle"),
            orderBy("timestamp", "desc"),
            limit(50)
          );
          const snap = await getDocs(q);

          if (snap.empty) {
            tbodyVisitas.innerHTML =
              "<tr><td colspan='7' style='text-align:center'>No hay visitas registradas</td></tr>";
            return;
          }

          tbodyVisitas.innerHTML = "";
          snap.forEach((docSnap) => {
            const d = docSnap.data();
            const ip = d.ip || "—";

            if (filtroIP && !ip.includes(filtroIP)) return;

            const fecha = d.timestamp
              ? new Date(d.timestamp).toLocaleString()
              : "—";
            const navegador = d.navegador || "—";
            const so = d.so || "—";
            const idioma = d.idioma || "—";
            const ciudad = d.ciudad || "—";
            const pagina = d.page || "/";

            tbodyVisitas.innerHTML += `<tr>
        <td>${fecha}</td>
        <td>${navegador}</td>
        <td>${so}</td>
        <td>${idioma}</td>
        <td>${ip}</td>
        <td>${ciudad}</td>
        <td>${pagina}</td>
      </tr>`;
          });
        } catch (err) {
          console.error(err);
          tbodyVisitas.innerHTML =
            "<tr><td colspan='7' style='text-align:center'>Error cargando visitas</td></tr>";
        }
      }
      document.getElementById("btnBuscarIP").addEventListener("click", () => {
        const ip = document.getElementById("buscarIP").value.trim();
        cargarVisitasDetalle(ip);
      });

      document
        .getElementById("refreshVisitasBtn")
        .addEventListener("click", () => cargarVisitasDetalle());

      // --- Correos ---
      async function cargarCorreos(filtroCorreo = "") {
        const tableBody = document.getElementById("tbodyCorreos");
        tableBody.innerHTML =
          "<tr><td colspan='2' style='text-align:center'>Cargando...</td></tr>";

        try {
          const q = query(
            collection(db, "correos"),
            orderBy("fecha", "desc"),
            limit(100)
          );
          const snap = await getDocs(q);

          if (snap.empty) {
            tableBody.innerHTML =
              "<tr><td colspan='2' style='text-align:center'>No hay correos registrados</td></tr>";
            return;
          }

          tableBody.innerHTML = "";
          snap.forEach((docSnap) => {
            const data = docSnap.data();
            const correo = data.correo || "";

            if (filtroCorreo && !correo.includes(filtroCorreo)) return;

            const fecha = data.fecha?.toDate
              ? data.fecha.toDate().toLocaleString()
              : "—";

            tableBody.innerHTML += `<tr>
        <td>${correo}</td>
        <td>${fecha}</td>
      </tr>`;
          });
        } catch (err) {
          console.error(err);
          tableBody.innerHTML =
            "<tr><td colspan='2' style='text-align:center'>Error cargando correos</td></tr>";
        }
      }

      document
        .getElementById("btnBuscarCorreo")
        .addEventListener("click", () => {
          const filtro = document.getElementById("buscarCorreo").value.trim();
          cargarCorreos(filtro);
        });

      document
        .getElementById("btnRefreshCorreos")
        .addEventListener("click", () => {
          cargarCorreos();
        });

      // -------------------------------
      // --- IP BAN / UNBAN FUNCTIONS ---
      // -------------------------------

      // Validación simple de IP (IPv4 e IPv6 básica)
      function isValidIP(ip) {
        if (!ip) return false;
        const ipv4 =
          /^(25[0-5]|2[0-4]\d|1?\d{1,2})(\.(25[0-5]|2[0-4]\d|1?\d{1,2})){3}$/;
        const ipv6 = /^([0-9a-fA-F]{1,4}:){1,7}[0-9a-fA-F]{1,4}$/;
        return ipv4.test(ip) || ipv6.test(ip);
      }

      // Banear IP: ip (string), reason (string), durationHours (number, 0 = permanente)
      async function banIp(ip, reason, durationHours = 0) {
        if (!isValidIP(ip)) throw new Error("IP no válida");
        if (!auth.currentUser) throw new Error("Usuario no autenticado");

        const docRef = doc(db, "ip_bans", ip);
        const nowISO = new Date().toISOString();
        const expiresAt =
          durationHours > 0
            ? new Date(Date.now() + durationHours * 3600e3).toISOString()
            : null;

        const data = {
          ip,
          reason: reason || "Sin motivo especificado",
          operator: auth.currentUser.email || auth.currentUser.uid || "unknown",
          permanent: durationHours === 0,
          createdAt: nowISO,
          expiresAt,
        };

        // Guardamos el ban con el ID = ip (fácil lookup)
        await setDoc(docRef, data);

        // registro opcional en logs (colección ip_ban_logs)
        await addDoc(collection(db, "ip_ban_logs"), {
          ip,
          action: "ban",
          operator: data.operator,
          reason: data.reason,
          createdAt: nowISO,
        });

        // actualizar UI
        await cargarBans();
      }

      // Desbanear IP
      async function unbanIp(ip) {
        if (!isValidIP(ip)) throw new Error("IP no válida");
        if (!auth.currentUser) throw new Error("Usuario no autenticado");

        const docRef = doc(db, "ip_bans", ip);
        await deleteDoc(docRef);

        await addDoc(collection(db, "ip_ban_logs"), {
          ip,
          action: "unban",
          operator: auth.currentUser.email || auth.currentUser.uid || "unknown",
          createdAt: new Date().toISOString(),
        });

        await cargarBans();
      }

      // Cargar bans para mostrar en la tabla
      async function cargarBans() {
        try {
          const snap = await getDocs(collection(db, "ip_bans"));
          if (snap.empty) {
            tbodyBans.innerHTML =
              "<tr><td colspan='5' style='text-align:center'>No hay bans</td></tr>";
            return;
          }
          tbodyBans.innerHTML = "";
          snap.forEach((s) => {
            const b = s.data();
            const exp = b.expiresAt
              ? new Date(b.expiresAt).toLocaleString()
              : b.permanent
              ? "Nunca"
              : "—";
            tbodyBans.innerHTML += `<tr>
              <td style="word-break:break-all">${b.ip}</td>
              <td>${b.permanent ? "Sí" : "No"}</td>
              <td>${exp}</td>
              <td>${b.operator || "—"}</td>
              <td>
                <button class="small-btn btn-danger" onclick="handleUnban('${
                  b.ip
                }')">Desbanear</button>
              </td>
            </tr>`;
          });
        } catch (err) {
          console.error(err);
          tbodyBans.innerHTML =
            "<tr><td colspan='5' style='text-align:center;color:red'>Error cargando bans</td></tr>";
        }
      }

      // Handlers de botones (UI)
      banBtn.addEventListener("click", async () => {
        try {
          const ip = ipInput.value.trim();
          const reason = reasonInput.value.trim();
          const duration = parseInt(durationInput.value || "0", 10);
          if (!ip || !reason) return alert("IP y motivo son obligatorios");
          if (!isValidIP(ip)) return alert("IP no válida");
          // confirmar
          if (!confirm(`¿Banear ${ip}? (permanente: ${duration === 0})`))
            return;
          await banIp(ip, reason, duration);
          alert("IP baneada ✅");
          ipInput.value = "";
          reasonInput.value = "";
          durationInput.value = "";
        } catch (err) {
          console.error(err);
          alert("Error al banear: " + (err.message || err));
        }
      });

      unbanBtn.addEventListener("click", async () => {
        try {
          const ip = unbanIpInput.value.trim();
          if (!ip) return alert("Introduce una IP");
          if (!isValidIP(ip)) return alert("IP no válida");
          if (!confirm(`¿Desbanear ${ip}?`)) return;
          await unbanIp(ip);
          alert("IP desbaneada ✅");
          unbanIpInput.value = "";
        } catch (err) {
          console.error(err);
          alert("Error al desbanear: " + (err.message || err));
        }
      });

      // Exponer handler para botones generados en tabla (global)
      window.handleUnban = async function (ip) {
        if (!confirm(`¿Desbanear ${ip}?`)) return;
        try {
          await unbanIp(ip);
          alert("IP desbaneada ✅");
        } catch (err) {
          console.error(err);
          alert("Error: " + (err.message || err));
        }
      };

      // -------------------------------
      // --- FIN IP BAN / UNBAN ---
      // -------------------------------

      // Si quieres bloquear el acceso al panel basado en IP, lo ideal es hacerlo server-side.
      // Aquí no he añadido bloqueo automático en onAuthStateChanged porque la IP real
      // no se obtiene con fiabilidad desde el frontend. Si quieres, puedo añadir un ejemplo
      // usando un Cloud Function para devolver la IP real y chequearla (dime si lo quieres).
    </script>
  </body>
</html>
