<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Descargas de Juegos</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        background: #f5f5f5;
        margin: 0;
        padding: 20px;
      }
      h1 {
        text-align: center;
      }
      .download-list {
        max-width: 600px;
        margin: 0 auto;
        padding: 0;
        list-style: none;
      }
      .download-list li {
        background: #fff;
        margin: 10px 0;
        padding: 15px;
        border-radius: 8px;
        box-shadow: 0 2px 6px rgba(0, 0, 0, 0.1);
        display: flex;
        justify-content: space-between;
        align-items: center;
      }
      .download-list a {
        text-decoration: none;
        background: #007bff;
        color: #fff;
        padding: 8px 15px;
        border-radius: 5px;
        transition: background 0.3s;
      }
      .download-list a:hover {
        background: #0056b3;
      }
    </style>
  </head>
  <body>
    <h1>Descargar Balancea! Balancea! y que no se caiga</h1>
    <ul class="download-list">
      <li>
        Android (APK)
        <a
          href="https://drive.google.com/drive/folders/1DD-N77n5exjDUSdrlKWl0jplMKC9Yb6p?usp=sharing"
          target="_blank">
          Descargar
        </a>
      </li>
      <li>
        Windows PC (EXE)
        <a
          href="https://drive.google.com/drive/folders/1DD-N77n5exjDUSdrlKWl0jplMKC9Yb6p?usp=sharing"
          target="_blank">
          Descargar
        </a>
      </li>
        </a>
      </li>
    </ul>
 <script type="module">
      import { initializeApp } from "https://www.gstatic.com/firebasejs/12.4.0/firebase-app.js";
      import {
        getFirestore,
        doc,
        getDoc,
        setDoc,
        updateDoc,
        increment,
        collection,
        addDoc,
      } from "https://www.gstatic.com/firebasejs/12.4.0/firebase-firestore.js";

      // Config Firebase
      const firebaseConfig = {
        apiKey: "AIzaSyCx8ITT_KZVSzZTWN20qV1yEZ5CwILkm2M",
        authDomain: "trollas-inc-administracion.firebaseapp.com",
        projectId: "trollas-inc-administracion",
        storageBucket: "trollas-inc-administracion.firebasestorage.app",
        messagingSenderId: "247309275509",
        appId: "1:247309275509:web:33d62925b18474b2ac833c",
        measurementId: "G-G2T4HD22YH",
      };
      const app = initializeApp(firebaseConfig);
      const db = getFirestore(app);

      // Contar visita solo una vez por dispositivo
      async function contarVisitaUnaVez() {
        const yaVisito = localStorage.getItem("yaVisito");
        if (yaVisito) return;

        const visitasRef = doc(db, "estadisticas", "visitas");
        const visitasSnap = await getDoc(visitasRef);

        if (!visitasSnap.exists()) {
          await setDoc(visitasRef, { contador: 1 });
        } else {
          await updateDoc(visitasRef, { contador: increment(1) });
        }

        localStorage.setItem("yaVisito", "true");
      }

      // Info del dispositivo
      function obtenerInfoDispositivo() {
        const ua = navigator.userAgent || "";
        let so = "Desconocido";
        if (/Android/i.test(ua)) so = "Android";
        else if (/iPhone|iPad|iPod/i.test(ua)) so = "iOS";
        else if (/Windows/i.test(ua)) so = "Windows";
        else if (/Mac/i.test(ua)) so = "MacOS";
        else if (/Linux/i.test(ua)) so = "Linux";

        const dispositivo = /Android|iPhone|iPad|iPod/i.test(ua)
          ? "Móvil"
          : "PC";

        let navegador = "Desconocido";
        if (/Chrome/i.test(ua) && !/Edge|OPR/i.test(ua)) navegador = "Chrome";
        else if (/Firefox/i.test(ua)) navegador = "Firefox";
        else if (/Safari/i.test(ua) && !/Chrome/i.test(ua))
          navegador = "Safari";
        else if (/Edge/i.test(ua)) navegador = "Edge";
        else if (/OPR|Opera/i.test(ua)) navegador = "Opera";

        const resolucion = `${window.innerWidth}x${window.innerHeight}`;
        const idioma = navigator.language || navigator.userLanguage || "";

        return {
          visitanteID: obtenerVisitanteID(),
          timestamp: new Date().toISOString(),
          so,
          dispositivo,
          navegador,
          resolucion,
          idioma,
          referrer: document.referrer || "",
          page: location.pathname + location.search || "",
        };
      }

      // Generar ID único por visitante
      function obtenerVisitanteID() {
        let id = localStorage.getItem("visitanteID");
        if (!id) {
          id =
            crypto && crypto.randomUUID
              ? crypto.randomUUID()
              : "v-" +
                Date.now() +
                "-" +
                Math.random().toString(36).slice(2, 9);
          localStorage.setItem("visitanteID", id);
        }
        return id;
      }

      // Obtener IP
      async function obtenerIP() {
        try {
          const res = await fetch("https://ipapi.co/json/");
          const data = await res.json();
          return {
            ip: data.ip || "",
            ciudad: data.city || "",
            pais: data.country_name || "",
          };
        } catch (err) {
          console.error("No se pudo obtener IP:", err);
          return { ip: "", ciudad: "", pais: "" };
        }
      }

      // Registrar visita detallada
      async function registrarVisitaDetalle() {
        try {
          await contarVisitaUnaVez();
          const info = obtenerInfoDispositivo();
          const ipInfo = await obtenerIP();
          const infoCompleta = { ...info, ...ipInfo };
          await addDoc(collection(db, "visitas_detalle"), infoCompleta);
        } catch (err) {
          console.error("Error registrando visita detalle:", err);
        }
      }

      // Ejecutar
      registrarVisitaDetalle();
    </script>
  </body>
</html>
